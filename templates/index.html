<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Compressible Flow Calculator</title>
<style>
/* Modern colorful UI with soft glass effect */
:root{
--bg: linear-gradient(135deg,#0f172a 0%, #031124 100%);
--card: rgba(255,255,255,0.06);
--accent1: #7c3aed; /* purple */
--accent2: #06b6d4; /* cyan */
--glass: rgba(255,255,255,0.04);
--glass-2: rgba(255,255,255,0.02);
--radius: 14px;
--mono: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
}
html,body{height:100%;margin:0;font-family:var(--mono);background:var(--bg);color:#e6eef8}
.wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:32px}
.card{width:900px;max-width:95vw;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--radius);box-shadow:0 10px 30px rgba(2,6,23,0.7);display:grid;grid-template-columns:1fr 420px;gap:20px;padding:24px}
.left{padding:18px}
h1{margin:0 0 6px 0;font-size:20px}
p.lead{margin:0 0 18px 0;color:#bcd7ee}
.group{margin-bottom:12px}
label{display:block;font-size:13px;margin-bottom:6px;color:#cfe9ff}
select,input[type='number'],input[type='text']{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:var(--glass);color:inherit;outline:none;box-sizing: border-box;}

select option {
    color: black; /* Fix for dropdown text color in some browsers */
}

.row{display:flex;gap:12px}
.small{flex:1}
.btn{display:inline-block;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;box-shadow:0 6px 18px rgba(12,6,20,0.6)}
.btn:active{transform:translateY(1px)}
.output{background:linear-gradient(180deg, rgba(0,0,0,0.24), rgba(255,255,255,0.02));padding:12px;border-radius:12px;height:100%;overflow:auto;border:1px solid rgba(255,255,255,0.03)}
.hidden { display: none; }
.results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px 16px; font-size: 14px; }
.results-grid span:nth-child(odd) { color: #a1c8ff; }
.error-msg { color: #ff8b8b; font-weight: bold; }
</style>
</head>
<body>

<div class="wrap">
    <div class="card">
        <div class="left">
            <h1>Compressible Flow Calculator</h1>
            <p class="lead">Select a flow type and enter a known value to calculate all related properties.</p>
            
            <form id="calc-form">
                <div class="row">
                    <div class="group small">
                        <label for="flow-type">Flow Type</label>
                        <select id="flow-type" name="flow_type">
                            <option value="Isentropic">Isentropic</option>
                            <option value="Normal Shock">Normal Shock</option>
                            <option value="Oblique Shock">Oblique Shock</option>
                        </select>
                    </div>
                    <div class="group small">
                        <label for="gamma">Gamma (γ)</label>
                        <input type="number" id="gamma" name="gamma" value="1.4" step="0.01">
                    </div>
                </div>

                <div id="isentropic-inputs">
                    <div class="group">
                        <label for="isen-type">Input Type</label>
                        <select id="isen-type" name="isen_type">
                            <option value="mach">Mach</option>
                            <option value="p_p0">p/p0</option>
                            <option value="rho_rho0">rho/rho0</option>
                            <option value="t_t0">T/T0</option>
                            <option value="a_a_star">A/A*</option>
                            <option value="mach_angle">Mach angle (μ)</option>
                            <option value="pm_angle">P-M angle (ν)</option>
                        </select>
                    </div>
                    <div class="group">
                        <label for="isen-value">Input Value</label>
                        <input type="number" id="isen-value" name="isen_value" required step="any" placeholder="e.g., 2.0">
                    </div>
                    <div class="group hidden" id="sub-super-choice">
                        <label>Flow Regime (for A/A*)</label>
                        <div style="display: flex; gap: 15px;">
                            <label><input type="radio" name="isen_sub" value="true" checked> Subsonic</label>
                            <label><input type="radio" name="isen_sub" value="false"> Supersonic</label>
                        </div>
                    </div>
                </div>
                
                <div id="normal-shock-inputs" class="hidden">
                     <div class="group">
                        <label for="ns-type">Input Type</label>
                        <select id="ns-type" name="ns_type">
                            <option value="m1">Upstream Mach (M1)</option>
                            <option value="m2">Downstream Mach (M2)</option>
                            <option value="p2_p1">p2/p1</option>
                            <option value="rho2_rho1">rho2/rho1</option>
                            <option value="t2_t1">T2/T1</option>
                            <option value="po2_po1">Po2/Po1</option>
                        </select>
                    </div>
                    <div class="group">
                        <label for="ns-value">Input Value</label>
                        <input type="number" id="ns-value" name="ns_value" step="any" placeholder="e.g., 2.0">
                    </div>
                </div>

                <div id="oblique-shock-inputs" class="hidden">
                    <div class="group">
                        <label for="os-m1">Upstream Mach (M1)</label>
                        <input type="number" id="os-m1" name="os_m1" value="3.0" step="0.01">
                    </div>
                    <div class="row">
                        <div class="group small">
                            <label for="os-type">Input Type</label>
                            <select id="os-type" name="os_type">
                                <option value="theta">Turn angle (θ)</option>
                                <option value="beta">Wave angle (β)</option>
                                <option value="m1n">Normal Mach (M1n)</option>
                            </select>
                        </div>
                         <div class="group small">
                            <label for="os-value" id="os-value-label">Angle Value (degrees)</label>
                            <input type="number" id="os-value" name="os_value" value="10" step="any">
                        </div>
                    </div>
                     <div class="group" id="weak-strong-choice">
                        <label>Solution Type</label>
                         <div style="display: flex; gap: 15px;">
                            <label><input type="radio" name="os_weak" value="true" checked> Weak Shock</label>
                            <label><input type="radio" name="os_weak" value="false"> Strong Shock</label>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn">Calculate</button>
            </form>
        </div>

        <div class="output">
            <pre id="results-output"><p>Results will appear here...</p></pre>
        </div>
    </div>
</div>

<script>
    const form = document.getElementById('calc-form');
    const flowTypeSelect = document.getElementById('flow-type');
    
    // Input sections
    const isenInputs = document.getElementById('isentropic-inputs');
    const nsInputs = document.getElementById('normal-shock-inputs');
    const osInputs = document.getElementById('oblique-shock-inputs');

    // Dynamic UI elements
    const isenTypeSelect = document.getElementById('isen-type');
    const subSuperChoice = document.getElementById('sub-super-choice');
    const osTypeSelect = document.getElementById('os-type');
    const weakStrongChoice = document.getElementById('weak-strong-choice');
    const osValueLabel = document.getElementById('os-value-label');

    const resultsOutput = document.getElementById('results-output');

    function updateVisibleInputs() {
        const selectedType = flowTypeSelect.value;
        isenInputs.classList.toggle('hidden', selectedType !== 'Isentropic');
        nsInputs.classList.toggle('hidden', selectedType !== 'Normal Shock');
        osInputs.classList.toggle('hidden', selectedType !== 'Oblique Shock');
    }

    function updateObliqueInputs() {
        const selected = osTypeSelect.value;
        // The weak/strong choice is only relevant when solving for beta from theta
        weakStrongChoice.classList.toggle('hidden', selected !== 'theta');
        
        // Update the label for the input value to be more descriptive
        if (selected === 'theta' || selected === 'beta') {
            osValueLabel.textContent = 'Angle Value (degrees)';
        } else if (selected === 'm1n') {
            osValueLabel.textContent = 'M1n Value';
        }
    }

    // Event listener to switch between main calculator types
    flowTypeSelect.addEventListener('change', updateVisibleInputs);

    // Event listener for isentropic-specific UI
    isenTypeSelect.addEventListener('change', () => {
        subSuperChoice.classList.toggle('hidden', isenTypeSelect.value !== 'a_a_star');
    });
    
    // Event listener for oblique-specific UI
    osTypeSelect.addEventListener('change', updateObliqueInputs);

    // Main form submission logic
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        resultsOutput.innerHTML = '<p>Calculating...</p>';

        const formData = new FormData(form);
        const data = {};
        formData.forEach((value, key) => {
            if (value !== '') data[key] = value;
        });

        // Convert radio button strings to boolean where applicable
        if (data.hasOwnProperty('isen_sub')) {
            data.isen_sub = (data.isen_sub === 'true');
        }
        if (data.hasOwnProperty('os_weak')) {
            data.os_weak = (data.os_weak === 'true');
        } else if (osTypeSelect.value !== 'theta') {
            // Ensure os_weak is not sent if it's hidden
            delete data.os_weak;
        }

        try {
            const response = await fetch('/calculate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const results = await response.json();

            if (results.error) {
                resultsOutput.innerHTML = `<p class="error-msg">Error: ${results.error}</p>`;
            } else {
                let html = '<div class="results-grid">';
                for (const key in results) {
                    html += `<span>${key}:</span><span>${results[key]}</span>`;
                }
                html += '</div>';
                resultsOutput.innerHTML = html;
            }

        } catch (error) {
            resultsOutput.innerHTML = `<p class="error-msg">A network or server error occurred.</p>`;
            console.error('Error:', error);
        }
    });
    
    // Set the initial state of the UI when the page loads
    updateVisibleInputs();
    updateObliqueInputs();
</script>

</body>
</html>
